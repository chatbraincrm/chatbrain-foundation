# Use .env ou .env.local na raiz (copie de .env.local.example)
services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
      target: web
      args:
        VITE_SUPABASE_URL: ${VITE_SUPABASE_URL}
        VITE_SUPABASE_ANON_KEY: ${VITE_SUPABASE_ANON_KEY}
        VITE_API_URL: ${VITE_API_URL:-}
    ports:
      - "8080:80"
    depends_on:
      - api

  api:
    build:
      context: .
      dockerfile: Dockerfile
      target: api
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      - PORT=3001
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - APP_BASE_URL=${APP_BASE_URL:-http://localhost:8080}
      - EMAIL_PROVIDER=${EMAIL_PROVIDER:-mock}
      - RESEND_API_KEY=${RESEND_API_KEY:-}
      - RESEND_FROM_EMAIL=${RESEND_FROM_EMAIL:-}
      - ENABLE_WHATSAPP_OUTBOUND=${ENABLE_WHATSAPP_OUTBOUND:-false}
    expose:
      - "3001"
